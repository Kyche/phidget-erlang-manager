#!/usr/bin/env python

"""
	@author: Jean-Lou Dupont
	
	from: http://www.debian.org/doc/debian-policy/ch-maintainerscripts.html
	Cases:
	
		postrm remove

		postrm purge
		
		old-postrm upgrade new-version
		
		new-postrm failed-upgrade old-version
		
		new-postrm abort-install
		
		new-postrm abort-install old-version
		
		new-postrm abort-upgrade old-version	
		
		disappearer's-postrm disappear overwriter overwriter-version
		

	Policy 10.6
		Packages must not remove any device files in the postrm or any other script. This is left to the system administrator.
		
	Policy 10.8
		Log files should be removed when the package is purged (but not when it is only removed). 	
		
	
"""

import os
import sys
import glob

this_lib     = "pem"
this_version = "$version"

try:    command = sys.argv[1]
except: command =''

try:    version = sys.argv[2]
except: version = ''

print "EPAPI: cmd[%s] version[%s]" % (command, version)

try:

	hdrs = ['epapi.h', 'epapi_msg.h', 'epapi_pkt.h']	
	dst = '/usr/lib/lib%s.so' % this_lib
	ddst = '/usr/lib/lib%s_debug.so' % this_lib

	# handle 'PURGE' command
	# =======================
	if command == 'purge':
	
		try:
			files = glob.glob('/usr/lib/lib%s*' % this_lib)
			
			for file in files:
				os.remove( file )
				print "EPAPI: removed [%s]" % file
		except:
			pass

	
	if (command == 'remove') or (command == 'purge'):
			
		print "EPAPI: removing header files"
		for hdr in hdrs:
			path = "/usr/include/%s" % hdr
			try:    
				os.remove( path )
				print "EPAPI: removed [%s]" % path
			except: 
				pass
	
		print "EPAPI: removing symlinks"
		try:
			files = glob.glob('/usr/lib/lib%s.*' % this_lib)
			
			for file in files:
				os.remove( file )
				print "EPAPI: removed [%s]" % file
		except:
			pass
	
except:
	pass

sys.exit(0)